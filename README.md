# ğŸ›¡ï¸ RustSentinel

> åŸºäºæ²æ›¦ C500 ç®—åŠ›çš„ Rust æ™ºèƒ½åˆçº¦æœ¬åœ°åŒ–éšç§å®‰å…¨å®¡è®¡ç»ˆç«¯

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)

## ğŸ“– é¡¹ç›®ç®€ä»‹

RustSentinel æ˜¯ä¸€ä¸ªä¸“ä¸º Solana/Rust æ™ºèƒ½åˆçº¦è®¾è®¡çš„æœ¬åœ°åŒ–å®‰å…¨å®¡è®¡å·¥å…·ã€‚åŸºäº **å›½äº§æ²æ›¦ C500 GPU** ç®—åŠ›å’Œ **DeepSeek-R1** æ·±åº¦æ¨ç†æ¨¡å‹ï¼Œå®ç°äº†åœ¨å®Œå…¨æœ¬åœ°ç¯å¢ƒä¸‹å¯¹æ™ºèƒ½åˆçº¦è¿›è¡Œä¸“ä¸šçº§å®‰å…¨å®¡è®¡ï¼Œç¡®ä¿ä»£ç éšç§çš„åŒæ—¶æä¾›é«˜è´¨é‡çš„æ¼æ´æ£€æµ‹æœåŠ¡ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸ”’ **ç»å¯¹éšç§**ï¼šå…¨æœ¬åœ°åŒ–æ¨ç†ï¼Œä»£ç æ°¸ä¸å‡ºåŸŸï¼Œæ¶ˆé™¤æ³„å¯†éšæ‚£
- ğŸ¯ **é€»è¾‘ä¸“ç²¾**ï¼šä¸“æ”» Rust/Anchor æ¡†æ¶ç‰¹æœ‰çš„æƒé™ç»•è¿‡ä¸é€»è¾‘ç¼ºé™·
- âš¡ **å®æ—¶å®¡è®¡**ï¼šåŸºäº C500 GPU çš„é«˜æ€§èƒ½æ¨ç†å¼•æ“ï¼Œç§’çº§å“åº”
- ğŸŒ **å‹å¥½ç•Œé¢**ï¼šGradio/Streamlit å¯è§†åŒ–äº¤äº’ï¼Œæ”¯æŒæµå¼è¾“å‡º
- ğŸ“Š **ä¸“ä¸šæŠ¥å‘Š**ï¼šè¾“å‡ºåŒ…å«æ¼æ´ç­‰çº§ã€æ”»å‡»åŸç†å’Œä¿®å¤å»ºè®®çš„ Markdown æŠ¥å‘Š

### è§£å†³çš„é—®é¢˜

é’ˆå¯¹ Web3 é¢†åŸŸï¼ˆç‰¹åˆ«æ˜¯ Solana/Rust ç”Ÿæ€ï¼‰æ™ºèƒ½åˆçº¦æ¼æ´é¢‘å‘å¯¼è‡´å·¨é¢èµ„äº§æŸå¤±çš„ç—›ç‚¹ï¼š

1. **äººå·¥å®¡è®¡æ˜‚è´µä¸”ä½æ•ˆ**ï¼šä¸“ä¸š Rust å®¡è®¡äººå‘˜ç¨€ç¼ºï¼Œä¸­å°å¼€å‘è€…éš¾ä»¥æ‰¿æ‹…é«˜æ˜‚è´¹ç”¨
2. **äº‘ç«¯ AI å­˜åœ¨éšç§é£é™©**ï¼šä½¿ç”¨äº‘ç«¯å¤§æ¨¡å‹éœ€ä¸Šä¼ æ ¸å¿ƒä»£ç ï¼Œå­˜åœ¨å•†ä¸šæœºå¯†æ³„éœ²é£é™©
3. **é€šç”¨æ¨¡å‹æ¼æŠ¥ç‡é«˜**ï¼šéš¾ä»¥ç²¾å‡†è¯†åˆ« Rust/Anchor æ¡†æ¶ç‰¹æœ‰çš„æ·±å±‚é€»è¾‘æ¼æ´

### ç›®æ ‡ç”¨æˆ·

- Solana/Rust æ™ºèƒ½åˆçº¦å¼€å‘è€…
- Web3 å®‰å…¨ç ”ç©¶å‘˜
- åŒºå—é“¾é¡¹ç›®åˆåˆ›å›¢é˜Ÿ
- é»‘å®¢æ¾å‚èµ›å›¢é˜Ÿ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ²æ›¦ C500 GPUï¼ˆ64GB æ˜¾å­˜æ¨èï¼‰æˆ–å…¶ä»–æ”¯æŒçš„ GPU
- è‡³å°‘ 100GB å¯ç”¨ç£ç›˜ç©ºé—´ï¼ˆç”¨äºæ¨¡å‹å­˜å‚¨ï¼‰

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/Xcoconut114514/RustSentinel-of-ShanghaiOpen.git
cd RustSentinel-of-ShanghaiOpen

# 2. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 3. å¯åŠ¨ vLLM æ¨ç†æœåŠ¡ï¼ˆéœ€åœ¨æ”¯æŒçš„ GPU ç¯å¢ƒï¼‰
vllm serve deepseek-ai/DeepSeek-R1-Distill-Qwen-7B \
    --dtype bfloat16 \
    --port 8000 \
    --model-name deepseek-audit

# 4. å¯åŠ¨ Web ç•Œé¢ï¼ˆæ–°ç»ˆç«¯ï¼‰
python src/app_gradio.py
```

è®¿é—® `http://localhost:8501` å¼€å§‹ä½¿ç”¨ï¼

## ğŸ“¦ å®‰è£…éƒ¨ç½²æŒ‡å—

### æ–¹æ³•ä¸€ï¼šæœ¬åœ°éƒ¨ç½²ï¼ˆæ¨èï¼‰

è¯¦ç»†éƒ¨ç½²æ­¥éª¤è¯·å‚è€ƒ [éƒ¨ç½²æ–‡æ¡£](docs/deployment.md)

#### ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡

```bash
# åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

#### ç¬¬äºŒæ­¥ï¼šæ¨¡å‹ä¸‹è½½

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ HuggingFace Hub
huggingface-cli download deepseek-ai/DeepSeek-R1-Distill-Qwen-7B

# æ–¹æ³• 2ï¼šä½¿ç”¨ ModelScopeï¼ˆå›½å†…æ¨èï¼‰
pip install modelscope
python -c "from modelscope import snapshot_download; snapshot_download('deepseek-ai/DeepSeek-R1-Distill-Qwen-7B')"
```

#### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨æœåŠ¡

```bash
# ç»ˆç«¯ 1ï¼šå¯åŠ¨æ¨ç†å¼•æ“
vllm serve deepseek-ai/DeepSeek-R1-Distill-Qwen-7B \
    --dtype bfloat16 \
    --gpu-memory-utilization 0.9 \
    --port 8000

# ç»ˆç«¯ 2ï¼šå¯åŠ¨ Web ç•Œé¢
cd src
python app_gradio.py
```

### æ–¹æ³•äºŒï¼šDocker éƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t rustsentinel:latest -f docker/Dockerfile .

# è¿è¡Œå®¹å™¨
docker run -d \
    --gpus all \
    -p 8000:8000 \
    -p 8501:8501 \
    rustsentinel:latest
```

è¯¦ç»†é…ç½®è¯·å‚è€ƒ [Docker éƒ¨ç½²æ–‡æ¡£](docs/docker-deployment.md)

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### å‘½ä»¤è¡Œå®¡è®¡

```python
from openai import OpenAI

# è¿æ¥æœ¬åœ°æ¨¡å‹
client = OpenAI(api_key="EMPTY", base_url="http://localhost:8000/v1")

# å¾…å®¡è®¡çš„ä»£ç 
rust_code = """
use anchor_lang::prelude::*;
#[program]
pub mod bank {
    use super::*;
    pub fn withdraw(ctx: Context<Withdraw>, amount: u64) -> Result<()> {
        let from = &mut ctx.accounts.from;
        let to = &mut ctx.accounts.to;
        **from.to_account_info().try_borrow_mut_lamports()? -= amount;
        **to.to_account_info().try_borrow_mut_lamports()? += amount;
        Ok(())
    }
}
"""

# å‘èµ·å®¡è®¡
response = client.chat.completions.create(
    model="deepseek-audit",
    messages=[
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„ Solana æ™ºèƒ½åˆçº¦å®‰å…¨å®¡è®¡ä¸“å®¶ã€‚è¯·åˆ†æä»£ç æ¼æ´ã€‚"},
        {"role": "user", "content": f"è¯·å®¡è®¡è¿™æ®µä»£ç ï¼š\n\n{rust_code}"}
    ],
    temperature=0.1
)

print(response.choices[0].message.content)
```

### Web ç•Œé¢ä½¿ç”¨

1. è®¿é—® `http://localhost:8501`
2. åœ¨å·¦ä¾§æ–‡æœ¬æ¡†ç²˜è´´ Rust ä»£ç 
3. ç‚¹å‡»"ğŸš€ å¼€å§‹å®¡è®¡"æŒ‰é’®
4. å³ä¾§å®æ—¶æ˜¾ç¤ºå®¡è®¡æŠ¥å‘Š

æ›´å¤šç¤ºä¾‹è¯·å‚è€ƒ [examples](examples/) ç›®å½•ã€‚

## ğŸ“š API æ–‡æ¡£

### æ ¸å¿ƒ API

#### `smart_audit(code_snippet: str) -> str`

å¯¹è¾“å…¥çš„ Rust ä»£ç è¿›è¡Œå®‰å…¨å®¡è®¡ã€‚

**å‚æ•°ï¼š**
- `code_snippet` (str): å¾…å®¡è®¡çš„ Rust æºä»£ç 

**è¿”å›ï¼š**
- str: Markdown æ ¼å¼çš„å®¡è®¡æŠ¥å‘Šï¼ŒåŒ…å«ï¼š
  - é£é™©ç­‰çº§ï¼ˆä¸¥é‡/é«˜å±/ä¸­å±/ä½å±ï¼‰
  - æ¼æ´æè¿°
  - æ”»å‡»åŸç†
  - ä¿®å¤å»ºè®®å’Œä»£ç 

**ç¤ºä¾‹ï¼š**
```python
from src.app_gradio import smart_audit

report = smart_audit("""
    pub fn withdraw(ctx: Context<Withdraw>, amount: u64) -> Result<()> {
        // ç¼ºå°‘æƒé™æ£€æŸ¥çš„ä»£ç 
    }
""")
print(report)
```

### ç³»ç»Ÿæç¤ºè¯å®šåˆ¶

å¯ä»¥é€šè¿‡ä¿®æ”¹ `config/system_prompt.txt` æ¥å®šåˆ¶å®¡è®¡è¡Œä¸ºï¼š

```python
system_prompt = """
ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åˆçº¦å®‰å…¨ä¸“å®¶ï¼Œä¸“æ³¨äºï¼š
1. æƒé™ç»•è¿‡æ¼æ´æ£€æµ‹
2. æ•´æ•°æº¢å‡º/ä¸‹æº¢æ£€æµ‹
3. é‡å…¥æ”»å‡»æ£€æµ‹
4. é€»è¾‘é”™è¯¯æ£€æµ‹
"""
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼æ— è®ºæ˜¯æŠ¥å‘Š bugã€æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼Œè¿˜æ˜¯æäº¤ä»£ç æ”¹è¿›ã€‚

### å¦‚ä½•è´¡çŒ®

1. **Fork æœ¬ä»“åº“**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯** (`git checkout -b feature/AmazingFeature`)
3. **æäº¤æ›´æ”¹** (`git commit -m 'Add some AmazingFeature'`)
4. **æ¨é€åˆ°åˆ†æ”¯** (`git push origin feature/AmazingFeature`)
5. **å¼€å¯ Pull Request**

### å¼€å‘è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- ä¸ºæ–°åŠŸèƒ½æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- æäº¤ä¿¡æ¯ä½¿ç”¨ä¸­æ–‡ï¼Œæ ¼å¼æ¸…æ™°

### æŠ¥å‘Šé—®é¢˜

å¦‚æœæ‚¨å‘ç° bug æˆ–æœ‰åŠŸèƒ½å»ºè®®ï¼Œè¯·ï¼š

1. åœ¨ [Issues](https://github.com/Xcoconut114514/RustSentinel-of-ShanghaiOpen/issues) ä¸­æœç´¢æ˜¯å¦å·²æœ‰ç›¸å…³é—®é¢˜
2. å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„ Issueï¼Œå¹¶æä¾›ï¼š
   - é—®é¢˜çš„è¯¦ç»†æè¿°
   - å¤ç°æ­¥éª¤
   - é¢„æœŸè¡Œä¸ºå’Œå®é™…è¡Œä¸º
   - ç³»ç»Ÿç¯å¢ƒä¿¡æ¯

## ğŸ“„ è®¸å¯è¯ä¿¡æ¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT License** å¼€æºåè®®ã€‚

è¿™æ„å‘³ç€æ‚¨å¯ä»¥ï¼š
- âœ… è‡ªç”±ä½¿ç”¨æœ¬é¡¹ç›®
- âœ… ä¿®æ”¹æºä»£ç 
- âœ… åˆ†å‘åŸå§‹æˆ–ä¿®æ”¹ç‰ˆæœ¬
- âœ… ç”¨äºå•†ä¸šç›®çš„

è¯¦ç»†å†…å®¹è¯·æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ“ è”ç³»æˆ‘ä»¬

- **é¡¹ç›®è´Ÿè´£äºº**: coconut
- **ç”µå­é‚®ç®±**: 2819404727@qq.com
- **æ‰‹æœº**: 18964592960
- **GitHub**: [@Xcoconut114514](https://github.com/Xcoconut114514)

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢ [æ²æ›¦é›†æˆç”µè·¯](https://www.metax-tech.com/) æä¾›çš„ C500 GPU ç®—åŠ›æ”¯æŒ
- æ„Ÿè°¢ [DeepSeek](https://www.deepseek.com/) å›¢é˜Ÿå¼€æºçš„ä¼˜ç§€æ¨ç†æ¨¡å‹
- æ„Ÿè°¢å¼€æºç¤¾åŒºçš„æ‰€æœ‰è´¡çŒ®è€…

## ğŸ—ºï¸ é¡¹ç›®è·¯çº¿å›¾

### å·²å®Œæˆ âœ…
- [x] åŸºäº C500 çš„ DeepSeek æ¨¡å‹éƒ¨ç½²
- [x] Gradio Web å¯è§†åŒ–ç•Œé¢
- [x] å•æ–‡ä»¶ä»£ç å®¡è®¡åŠŸèƒ½
- [x] Solana ç»å…¸æ¼æ´æ£€æµ‹ä¼˜åŒ–

### è¿›è¡Œä¸­ ğŸš§
- [ ] æ•´ä¸ª GitHub ä»“åº“æ‰¹é‡æ‰«æ
- [ ] RAG æ£€ç´¢å¢å¼ºï¼ˆæŒ‚è½½ Solana å®‰å…¨æ–‡æ¡£åº“ï¼‰
- [ ] PDF/HTML æ ¼å¼å®¡è®¡æŠ¥å‘Šå¯¼å‡º

### è®¡åˆ’ä¸­ ğŸ“…
- [ ] VS Code æ’ä»¶é›†æˆ
- [ ] CI/CD æµæ°´çº¿é›†æˆ
- [ ] å¤šè¯­è¨€åˆçº¦æ”¯æŒï¼ˆMoveã€Cairo ç­‰ï¼‰
- [ ] æ¼æ´çŸ¥è¯†åº“æ„å»º

## ğŸ“Š æŠ€æœ¯æ¶æ„

```
RustSentinel
â”œâ”€â”€ ç”¨æˆ·äº¤äº’å±‚ (Gradio/Streamlit)
â”œâ”€â”€ Prompt ç¼–æ’å±‚ (System Prompt)
â”œâ”€â”€ æœ¬åœ°æ¨ç†å±‚ (vLLM + DeepSeek-R1)
â””â”€â”€ ç¡¬ä»¶åŠ é€Ÿå±‚ (æ²æ›¦ C500 GPU)
```

è¯¦ç»†æ¶æ„è¯´æ˜è¯·å‚è€ƒ [æŠ€æœ¯æ–‡æ¡£](docs/architecture.md)ã€‚

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ Star æ”¯æŒï¼
